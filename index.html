<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MusiChris App</title>

    <!-- PWA -->
    <link rel="manifest" href="Manifest.json?v=20">
    <meta name="theme-color" content="#0f0f1a">
    <link rel="apple-touch-icon" href="assets/icon-512.png">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">


    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css?v=30">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <!-- PANTALLA DE LOGIN -->
    <div id="view-login">
        <div class="login-card">
            <div class="logo-text">Musi<span>Chris</span> üéµ</div>
            <p style="color:var(--text-dim); margin-bottom:20px">Tu m√∫sica, en cualquier lugar</p>
            <input type="email" id="loginEmail" class="login-input" placeholder="Usuario o Email">
            <div class="password-wrapper">
                <input type="password" id="loginPass" class="login-input" placeholder="Contrase√±a">
                <span class="material-icons-round pass-toggle" id="btnTogglePass">visibility_off</span>
            </div>
            <button id="btnLoginBtn" class="btn-login" onclick="handleLoginAttempt()">ENTRAR</button>
        </div>
    </div>

    <!-- VISTA ADMIN -->
    <div id="view-admin" class="view-section">
        <div class="container">
            <header>
                <div class="brand">MusiChris <span>Admin</span></div>
                <div class="header-right">
                    <button class="btn-icon" onclick="openModal('dom_modal_announcement')"><span
                            class="material-icons-round">campaign</span></button>
                    <button class="btn-icon" onclick="openModal('dom_modal_settings')"><span
                            class="material-icons-round">settings</span></button>
                    <div class="user-profile" onclick="openProfile()">
                        <img id="adminAvatar" src="" class="avatar">
                    </div>
                    <button class="btn-icon" onclick="app_logout()"><span
                            class="material-icons-round">logout</span></button>
                </div>
            </header>

            <div class="stats-grid">
                <div class="card">
                    <h3>Canciones</h3>
                    <div class="value" id="statsTotalSongs">0</div>
                </div>
                <div class="card">
                    <h3>Usuarios</h3>
                    <div class="value" id="statsTotalUsers">0</div>
                </div>
                <div class="card">
                    <h3>Hosting CLOUDINARY</h3>
                    <div class="value" id="statsCloudinaryUsage">0%</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('admin-music', this)">M√∫sica</button>
                <button class="tab-btn" onclick="switchTab('admin-playlists', this)">Listas</button>
                <button class="tab-btn" onclick="switchTab('admin-albums', this)">√Ålbumes</button>
                <button class="tab-btn" onclick="switchTab('admin-users', this)">Usuarios</button>
                <button class="tab-btn" onclick="switchTab('admin-stats', this)">Estad√≠sticas</button>
            </div>

            <div id="admin-music" class="list-tab-content active">
                <div class="btn-dashed-style" onclick="openUpload()">+ Subir Canci√≥n</div>
                <div id="adminSongList"></div>
            </div>

            <div id="admin-playlists" class="list-tab-content">
                <div id="adminPlaylistGrid" class="playlist-grid"></div>
            </div>

            <div id="admin-albums" class="list-tab-content">
                <div class="btn-dashed-style" onclick="createAlbum()">+ Crear √Ålbum</div>
                <div id="adminAlbumGrid" class="playlist-grid"></div>
            </div>

            <div id="admin-users" class="list-tab-content">
                <div id="usersListGrid"></div>
            </div>

            <div id="admin-stats" class="list-tab-content">
                <div class="stats-summary-cards" id="statsSummaryCards">
                    <!-- KPIs r√°pidos aqu√≠ -->
                </div>
                <div class="stats-main-row">
                    <div class="stats-col-left">
                        <div class="stats-card chart-card">
                            <h4><span class="material-icons-round">analytics</span> M√°s Escuchadas</h4>
                            <div class="chart-wrapper">
                                <canvas id="topSongsChart"></canvas>
                            </div>
                        </div>
                        <div class="stats-card chart-card">
                            <h4><span class="material-icons-round">insights</span> Actividad Semanal</h4>
                            <div class="chart-wrapper">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div id="statsMainContainer" class="stats-premium-grid">
                        <!-- Top listas aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- VISTA USUARIO -->
    <div id="view-user" class="view-section">
        <div class="container">
            <header>
                <div class="brand">Musi<span>Chris</span></div>
                <div class="header-right">
                    <button class="btn-icon" onclick="openNotifications()"><span
                            class="material-icons-round">notifications</span><span class="notification-badge"
                            style="display:none"></span></button>
                    <div class="user-profile" onclick="openProfile()">
                        <img id="userAvatarImg" src="" class="avatar">
                        <span id="userGreeting">Hola</span>
                    </div>
                    <button class="btn-icon" onclick="app_logout()"><span
                            class="material-icons-round">logout</span></button>
                </div>
            </header>

            <div id="userNotificationsBanner" class="notif-banner" style="display:none;">
                <span class="material-icons-round">campaign</span>
                <div id="latestNotifText" class="notif-banner-text">¬°Mensaje importante!</div>
                <button class="notif-close-btn" onclick="this.parentElement.style.display='none'"><span
                        class="material-icons-round">close</span></button>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('user-music', this)">M√∫sica</button>
                <button class="tab-btn" onclick="switchTab('user-playlists', this)">Listas</button>
                <button class="tab-btn" onclick="switchTab('user-albums', this)">√Ålbumes</button>
            </div>

            <div id="user-music" class="list-tab-content active">
                <div id="userSongList"></div>
            </div>

            <div id="user-playlists" class="list-tab-content">
                <div id="userPlaylistGrid" class="playlist-grid"></div>
            </div>

            <div id="user-albums" class="list-tab-content">
                <div id="userAlbumGrid" class="playlist-grid"></div>
            </div>
        </div>
    </div>

    <!-- REPRODUCTOR INFERIOR -->
    <div id="mainPlayer" class="bottom-player" style="display:none;" onclick="openModal('view-guest-player')">
        <!-- Izquierda: Info Canci√≥n -->
        <div class="player-info">
            <img id="pCoverMini" src="" class="song-cover">
            <div class="p-text">
                <h4 id="pTitle">T√≠tulo</h4>
                <p id="pArtist">Artista</p>
            </div>
        </div>

        <!-- Centro: Controles y Slider (Hidden on mobile via CSS) -->
        <div class="player-center-group">
            <div class="controls-row">
                <span class="material-icons-round" onclick="event.stopPropagation(); toggleShuffle(this)">shuffle</span>
                <span class="material-icons-round" onclick="event.stopPropagation(); prev()">skip_previous</span>
                <div class="btn-play-circle" onclick="event.stopPropagation(); toggle_play()">
                    <span id="iconPlay" class="material-icons-round">play_arrow</span>
                </div>
                <span class="material-icons-round" onclick="event.stopPropagation(); next()">skip_next</span>
                <span class="material-icons-round" onclick="event.stopPropagation(); toggleRepeat(this)">repeat</span>
            </div>
            <div class="progress-container">
                <span class="time-label" id="miniCurTime">0:00</span>
                <input type="range" id="seekSlider" value="0" min="0" max="100" onclick="event.stopPropagation()"
                    oninput="seekAudio(event)">
                <span class="time-label" id="miniTotTime">0:00</span>
            </div>
        </div>

        <!-- Derecha: Mini Controles (Mobile only via CSS) -->
        <div class="minimized-player-controls">
            <span id="iconPlayMin" class="material-icons-round"
                onclick="event.stopPropagation(); toggle_play()">play_arrow</span>
            <span class="material-icons-round" onclick="event.stopPropagation(); next()">skip_next</span>
        </div>
    </div>

    <!-- MODAL REPRODUCTOR FULLSCREEN (Guest Player) -->
    <div id="view-guest-player" class="modal-overlay">
        <div id="guest-full-player"
            style="width:100%; height:100%; display:flex; flex-direction:column; padding:20px 20px;">
            <header>
                <button class="btn-icon" onclick="closeModal('view-guest-player')"><span
                        class="material-icons-round">expand_more</span></button>
                <div style="font-weight:bold; font-size:0.9rem; letter-spacing:2px; color:var(--text-dim)">REPRODUCIENDO
                </div>
                <button class="btn-icon" onclick="openModal('dom_modal_eq')">
                    <div id="visualizer-mini" class="playing-indicator" style="display:flex;">
                        <div class="playing-bar" style="height:12px"></div>
                        <div class="playing-bar" style="height:18px"></div>
                        <div class="playing-bar" style="height:14px"></div>
                    </div>
                </button>
            </header>

            <div class="guest-container"
                style="display:flex; flex-direction:column; align-items:center; flex:1; justify-content:center;">
                <div class="guest-cover-container">
                    <div id="guestCover"></div>
                    <span id="btnLikePlayer" class="material-icons-round btn-like-on-cover"
                        onclick="toggleLikeCurrent()">favorite_border</span>
                </div>
                <div style="text-align:center;">
                    <h2 id="guestTitle" style="font-size:1.8rem; margin:0;">T√≠tulo</h2>
                    <p id="guestArtist" style="color:var(--accent); font-size:1.1rem; margin-top:10px;">Artista</p>
                </div>
            </div>

            <div class="player-controls-main" style="width:100%; max-width:500px; margin:30px auto;">
                <div class="progress-bar-area">
                    <span id="expCurTime" class="time-label-fixed">0:00</span>
                    <input type="range" id="expandedSeekSlider" class="expanded-seek-slider" value="0" min="0" max="100"
                        oninput="seekAudio(event)">
                    <span id="expTotTime" class="time-label-fixed">0:00</span>
                </div>

                <div class="expanded-controls">
                    <span class="material-icons-round secondary-player-btn" onclick="toggleShuffle(this)">shuffle</span>
                    <span class="material-icons-round control-btn-large" onclick="prev()">skip_previous</span>
                    <div class="btn-play-circle-large" onclick="toggle_play()">
                        <span id="iconPlayBig" class="material-icons-round">play_arrow</span>
                    </div>
                    <span class="material-icons-round control-btn-large" onclick="next()">skip_next</span>
                    <span class="material-icons-round secondary-player-btn" onclick="toggleRepeat(this)">repeat</span>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL NOTIFICACIONES -->
    <div id="dom_modal_notifications" class="modal-overlay">
        <div class="modal-content notification-modal">
            <header class="modal-header-simple">
                <h3>Notificaciones</h3>
                <button class="btn-icon" onclick="closeModal('dom_modal_notifications')">
                    <span class="material-icons-round">close</span>
                </button>
            </header>
            <div id="notificationsList" class="notifications-scroll">
                <p class="empty-notif">No tienes notificaciones nuevas.</p>
            </div>
        </div>
    </div>

    <!-- MODALES DE ACCI√ìN -->
    <div id="dom_modal_upload" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalUploadTitle">Subir Canci√≥n</h3>
            <input type="text" id="upTitle" class="form-input" placeholder="T√≠tulo">
            <input type="text" id="upGenre" class="form-input" placeholder="Artista / G√©nero">
            <select id="upAlbum" class="form-input"></select>
            <input type="text" id="upUrl" class="form-input" placeholder="URL MP3">
            <div style="display:flex; gap:10px;">
                <button class="btn-submit" style="background:#333; color:white"
                    onclick="closeModal('dom_modal_upload')">Cancelar</button>
                <button class="btn-submit" onclick="do_upload()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="dom_modal_profile" class="modal-overlay">
        <div class="modal-content" style="text-align:center;">
            <h3>Mi Perfil</h3>
            <img id="profilePreview" class="avatar" style="width:100px; height:100px; margin:20px auto;">
            <input type="text" id="profileName" class="form-input" placeholder="Nombre">
            <input type="email" id="profileEmail" class="form-input" disabled style="opacity:0.5;">
            <button class="btn-submit" onclick="changeAvatar()">Cambiar Avatar</button>
            <button class="btn-submit" style="background:#333; margin-top:10px;"
                onclick="closeModal('dom_modal_profile')">Cerrar</button>
        </div>
    </div>

    <!-- MODAL ANUNCIOS -->
    <div id="dom_modal_announcement" class="modal-overlay">
        <div class="modal-content">
            <h3>Enviar Notificaci√≥n</h3>
            <p style="font-size:0.8rem; color:var(--text-dim); margin-bottom:15px;">Este mensaje les aparecer√° a todos
                los usuarios.</p>
            <textarea id="annText" class="form-input" style="height:100px; padding:15px;"
                placeholder="Escribe el anuncio..."></textarea>
            <div style="display:flex; gap:10px;">
                <button class="btn-submit" style="background:#333;"
                    onclick="closeModal('dom_modal_announcement')">Cancelar</button>
                <button class="btn-submit" onclick="sendNotification()">Enviar a todos</button>
            </div>
        </div>
    </div>

    <!-- MODAL SETTINGS -->
    <div id="dom_modal_settings" class="modal-overlay">
        <div class="modal-content">
            <h3>Ajustes</h3>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <span>Modo Oscuro</span>
                <span class="material-icons-round">dark_mode</span>
            </div>
            <button class="btn-submit" onclick="closeModal('dom_modal_settings')">Cerrar</button>
        </div>
    </div>

    <!-- MODAL VISTA DE √ÅLBUM (Detalle) -->
    <div id="dom_modal_album_detail" class="modal-overlay">
        <div class="modal-content album-detail-modal">
            <header class="album-modal-header">
                <button class="btn-icon" onclick="closeModal('dom_modal_album_detail')">
                    <span class="material-icons-round">close</span>
                </button>
                <h3 id="modalAlbumTitle">Detalle del √Ålbum</h3>
            </header>

            <div class="album-detail-info">
                <img id="modalAlbumCover" src="" class="album-large-cover">
                <div class="album-text-info">
                    <h2 id="modalAlbumName">Nombre del √Ålbum</h2>
                    <p id="modalAlbumArtist">Artista</p>
                    <button class="btn-play-album" id="btnPlayAllAlbum">
                        <span class="material-icons-round">play_arrow</span> REPRODUCIR TODO
                    </button>
                </div>
            </div>

            <div id="modalAlbumSongsList" class="album-modal-songs">
                <!-- Canciones se cargan aqu√≠ -->
            </div>
        </div>
    </div>

    <div id="customToast" class="customToast">Mensaje</div>

    <!-- Scripts -->
    <script src="js/config.js?v=30"></script>
    <script src="js/data-manager.js?v=30"></script>
    <script src="js/ui-renderer.js?v=30"></script>
    <script src="js/player.js?v=30"></script>
    <script src="js/pwa-manager.js?v=30"></script>
    <script src="js/modals.js?v=30"></script>
    <script src="js/app.js?v=30"></script>

</body>

</html>