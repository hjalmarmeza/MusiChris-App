<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MusiChris App</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #151521; --secondary: #1E1E2C; --accent: #FFC312; --text: #ffffff; --danger: #ff4757; --dashed-border: #F79F1F; }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; font-family: 'Poppins', sans-serif; background: var(--primary); color: var(--text); height: 100vh; width: 100vw; overflow: hidden; }
        
        input[type="file"] { display: none !important; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 6000 !important; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #252535; width: 90%; max-width: 400px; padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.05); max-height: 85vh; display: flex; flex-direction: column; position: relative; }
        
        #view-login { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 2000; background: var(--primary); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .login-card { background: var(--secondary); padding: 40px 30px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.4); }
        .logo-text { font-size: 2.2rem; font-weight: 700; margin-bottom: 20px; }
        .logo-text span { color: var(--accent); }
        .password-wrapper { position: relative; width: 100%; margin-bottom: 10px; }
        .login-input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); background: #252535; color: white; font-size: 1rem; }
        .pass-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: #888; cursor: pointer; z-index: 10; font-size: 1.2rem; }
        .btn-login { width: 100%; padding: 15px; margin-top: 20px; border-radius: 12px; border: none; background: var(--accent); color: #1a1a2e; font-weight: 800; font-size: 1.1rem; cursor: pointer; }

        .view-section { display: none; height: 100%; width: 100%; overflow-y: auto; padding-bottom: 140px; opacity: 0; transition: opacity 0.3s; }
        .view-section.active { opacity: 1; }
        .container { padding: 20px; max-width: 800px; margin: 0 auto; }

        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-top: 15px; }
        .brand { font-size: 1.6rem; font-weight: 800; letter-spacing: -1px; }
        .header-right { display: flex; align-items: center; gap: 10px; }
        .btn-icon { background: rgba(255,255,255,0.08); border: none; width: 40px; height: 40px; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .user-profile { display: flex; align-items: center; gap: 8px; background: var(--secondary); padding: 4px 12px 4px 4px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.05); cursor: pointer; }
        .avatar { width: 34px; height: 34px; border-radius: 50%; object-fit: cover; border: 1px solid var(--accent); }

        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .card { background: var(--secondary); padding: 5px; border-radius: 16px; text-align: center; border: 1px solid rgba(255,255,255,0.03); height: 95px; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .card h3 { font-size: 0.65rem; color: #aaa; margin: 0 0 5px 0; text-transform: uppercase; letter-spacing: 0.5px; }
        .card .value { font-size: 1.3rem; font-weight: bold; color: var(--accent); margin: 0; }

        .tabs { display: flex; width: 100%; gap: 10px; margin-bottom: 15px; }
        .tab-btn { flex: 1; text-align: center; background: var(--secondary); border: 1px solid rgba(255,255,255,0.05); color: #888; padding: 12px 0; border-radius: 12px; cursor: pointer; font-weight: 600; transition: 0.3s; font-size: 0.9rem; }
        .tab-btn.active { background: var(--accent); color: #1a1a2e; border-color: var(--accent); }
        .list-tab-content { display: none; }
        .list-tab-content.active { display: block; animation: fadeIn 0.4s; }

        .btn-dashed-style { display: block; width: 100%; padding: 18px; margin-bottom: 25px; margin-top: 5px; background: rgba(247, 159, 31, 0.05); color: var(--dashed-border); border: 2px dashed var(--dashed-border); border-radius: 14px; font-weight: 800; font-size: 1.1rem; text-align: center; cursor: pointer; position: relative; z-index: 10; }
        .btn-dashed-style:active { background: rgba(247, 159, 31, 0.15); transform: scale(0.98); }
        .announcement-box { cursor: default !important; text-align: left; }
        .announcement-box h3 { margin: 0 0 5px 0; font-size: 0.8rem; color: white; display: flex; align-items: center; gap: 5px; }
        .announcement-box p { margin: 0; color: #ccc; font-size: 0.9rem; font-weight: normal; }

        .song-list-item { display: flex; align-items: center; padding: 10px; background: var(--secondary); margin-bottom: 10px; border-radius: 14px; border: 1px solid rgba(255,255,255,0.02); }
        .song-cover { width: 50px; height: 50px; border-radius: 10px; background-size: cover; background-position: center; margin-right: 15px; flex-shrink: 0; background-color: #333; position: relative; }
        .song-info { flex: 1; min-width: 0; }
        .song-title { font-weight: 600; font-size: 0.95rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 3px; }
        .song-artist { font-size: 0.8rem; color: #888; }
        .song-actions { display: flex; gap: 8px; align-items: center; }
        .btn-list-action { background: rgba(255,255,255,0.1); border: none; width: 32px; height: 32px; border-radius: 50%; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .playlist-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        .collection-card { background: var(--secondary); border-radius: 18px; padding: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.03); position: relative; display: flex; flex-direction: column; align-items: center; }
        .collection-cover { width: 200px; height: 200px; background-size: cover; background-position: center; border-radius: 15px; margin-bottom: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); background-color: #333; }
        .collection-card h4 { margin: 0 0 10px 0; font-size: 1.2rem; color: white; white-space: normal; }
        .album-admin-tools { display: flex; gap: 15px; margin-top: auto; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.05); width: 100%; justify-content: center; }
        .btn-alb-tool { width: 35px; height: 35px; border-radius: 8px; border: none; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1rem; }
        .pl-icon-bg { background-size: 40% !important; background-repeat: no-repeat !important; background-position: center !important; }
        .grad-1 { background: linear-gradient(135deg, #FF9F43 0%, #ff4757 100%); }
        .grad-2 { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .grad-3 { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        .user-list-item { display: flex; justify-content: space-between; align-items: center; background: var(--secondary); padding: 12px 20px; border-radius: 12px; margin-bottom: 10px; }
        .user-info { display: flex; align-items: center; gap: 15px; }
        .user-info img { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: #333; }
        .btn-delete-user { background: var(--danger); width: 35px; height: 35px; border-radius: 8px; border: none; color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; }

        #view-guest-player { background: linear-gradient(180deg, #252535 0%, #151521 100%); display: none; flex-direction: column; padding: 20px; z-index: 5000; position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        .guest-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: space-evenly; width: 100%; max-width: 500px; margin: 0 auto; }
        #guestCover { width: 75vw; height: 75vw; max-width: 350px; max-height: 350px; border-radius: 25px; background-size: cover; background-position: center; box-shadow: 0 20px 50px rgba(0,0,0,0.6); }
        .guest-info-area { text-align: center; width: 100%; margin-bottom: 20px; }
        .guest-info-area h2 { margin: 0 0 10px 0; font-size: 1.5rem; }
        .guest-info-area p { margin: 0; color: #aaa; font-size: 1rem; }
        .guest-controls-extra { display: flex; justify-content: space-around; width: 100%; }
        .btn-guest-action { background: transparent; border: none; color: white; cursor: pointer; font-size: 1.8rem; }
        .guest-controls-main { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 15px; }
        #iconPlayBig { font-size: 4.5rem; }
        
        .progress-container { width: 100%; margin: 15px 0; display: flex; align-items: center; gap: 10px; }
        input[type="range"] { flex: 1; height: 4px; border-radius: 5px; -webkit-appearance: none; background: #444; cursor: pointer; width: 100%; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--accent); border-radius: 50%; }
        .time-display { font-size: 0.8rem; color: #888; min-width: 35px; }
        .eq-band { display: flex; flex-direction: column; align-items: center; height: 100%; }
        .eq-slider { writing-mode: bt-lr; -webkit-appearance: slider-vertical; width: 8px; height: 100px !important; flex: 1; }
        .eq-band label { font-size: 0.8rem; color: #aaa; margin-top: 10px; }

        .bottom-player { position: fixed; bottom: 0; left: 0; width: 100%; height: 90px; background: rgba(30, 30, 44, 0.98); border-top: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; z-index: 1000; transition: transform 0.3s ease-in-out; }
        .bottom-player.hidden { transform: translateY(100%); }
        .player-info { width: 25%; display: flex; align-items: center; gap: 12px; overflow: hidden; margin-right: 15px; }
        .player-info h4 { margin: 0; font-size: 1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .player-info p { margin: 0; font-size: 0.8rem; color: #aaa; }
        .player-center-group { width: 45%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .controls-row { display: flex; flex-direction: row; align-items: center; justify-content: center; gap: 20px; width: 100%; margin-bottom: 5px; }
        .btn-play-circle { width: 45px; height: 45px; background: white; border-radius: 50%; color: black; display: flex; align-items: center; justify-content: center; cursor: pointer; flex-shrink: 0; }
        
        .player-right-group { width: 30%; display: flex; justify-content: flex-end; gap: 15px; color: #aaa; align-items: center; min-width: 150px; }
        .minimized-player-controls { display: none; }
        .small-icon { font-size: 1.2rem; color:#aaa; cursor: pointer; }

        .close-btn-x { position: absolute; top: 15px; right: 20px; font-size: 1.5rem; color: #888; cursor: pointer; font-weight: bold; background: transparent; border: none; }
        #plDetailList, #adminSongList { overflow-y: auto; flex: 1; margin-top: 15px; }
        .form-input { width: 100%; padding: 12px; margin: 8px 0; background: #1a1a2e; border: 1px solid #333; color: white; border-radius: 8px; }
        .btn-submit { width: 100%; padding: 12px; background: var(--accent); color: #1a1a2e; border: none; border-radius: 8px; font-weight: 800; margin-top: 20px; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        .close-modal { background: transparent; border: 1px solid #666; color: #ddd; }

        .customToast { position: fixed; bottom: 120px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 15px 25px; border-radius: 10px; z-index: 9999; display: none; }

        @media (max-width: 768px) {
            .container { padding: 15px; }
            .brand { font-size: 1.3rem; }
            #adminNameDisplay, #userGreetingName { display: none; }
            .user-profile { background: transparent; border: none; padding: 0; }
            .header-right { gap: 8px; }
            .btn-icon { width: 35px; height: 35px; font-size: 1.1rem; }
            .card { height: 90px; } 
            .card h3 { font-size: 0.6rem; } 
            .card .value { font-size: 1.1rem; }
            .playlist-grid { grid-template-columns: 1fr !important; }
            .collection-cover { width: 180px; height: 180px; }
            .player-center-group, .player-right-group { display: none !important; }
            .minimized-player-controls { display: flex !important; align-items: center; gap: 20px; }
            .minimized-player-controls span { font-size: 2.2rem !important; color: white; }
            #iconPlayMin { color: var(--accent); font-size: 2.8rem !important; }
            .bottom-player { padding: 0 20px !important; height: 85px !important; }
            .player-info { width: 55%; }
        }
    </style>
</head>
<body>

    <div id="view-login">
        <div class="login-card">
            <div class="logo-text">Musi<span>Chris</span> </div>
            <p style="color:#aaa; margin-bottom:20px">Bienvenido</p>
            <input type="email" id="loginEmail" class="login-input" placeholder="Usuario o Email">
            <div class="password-wrapper">
                <input type="password" id="loginPass" class="login-input" placeholder="Contrase帽a">
                <span class="material-icons-round pass-toggle" id="btnTogglePass">visibility_off</span>
            </div>
            <button id="btnLoginBtn" class="btn-login">Ingresar</button>
        </div>
    </div>

    <div id="view-admin" class="view-section">
        <div class="container">
            <header>
                <div class="brand">MusiChris <span>Admin</span></div>
                <div class="header-right">
                    <button class="btn-icon"><span class="material-icons-round">campaign</span></button>
                    <button class="btn-icon"><span class="material-icons-round">settings</span></button>
                    <div class="user-profile">
                        <img id="adminAvatar" src="" class="avatar">
                        <span id="adminNameDisplay">Admin</span>
                    </div>
                    <button class="btn-icon btn-logout"><span class="material-icons-round">logout</span></button>
                </div>
            </header>

            <div class="stats-grid">
                <div class="card">
                    <div style="display:flex; justify-content:space-between; width:100%; align-items:center;">
                        <h3 style="margin:0">Canciones</h3>
                        <span class="material-icons-round" style="cursor:pointer; color:var(--accent); font-size:1.2rem;">calendar_today</span>
                    </div>
                    <span class="material-icons-round" style="color:#e67e22; margin:5px 0;">library_music</span>
                    <div class="value" id="statsTotalSongs">0</div>
                </div>
                <div class="card"><h3>Usuarios</h3><span class="value" id="statsTotalUsers">0</span></div>
                <div class="card"><h3>Nube (25GB)</h3><div class="value" id="statsCloud">0%</div></div>
            </div>

            <div class="tabs">
                <button class="tab-btn active">M煤sica</button>
                <button class="tab-btn">Playlist</button>
                <button class="tab-btn">lbum</button>
                <button class="tab-btn">Usuarios</button>
            </div>

            <div id="admin-music" class="list-tab-content active">
                <div class="btn-dashed-style">+ Subir Canci贸n</div>
                <div style="background:#252535; padding:10px; border-radius:12px; margin-bottom:15px; display:flex; align-items:center;">
                    <span class="material-icons-round" style="color:#aaa; margin-right:10px;">search</span>
                    <input type="text" id="searchInputAdmin" placeholder="Buscar canci贸n..." style="background:transparent; border:none; color:white; width:100%; outline:none;">
                </div>
                <div id="adminSongList"></div>
            </div>
        </div>
    </div>

    <div id="view-user" class="view-section">
        <div class="container">
            <header>
                <div class="brand">Musi<span>Chris</span></div>
                <div class="header-right">
                    <div class="user-profile">
                        <img id="userAvatarImg" src="" class="avatar">
                        <span id="userGreeting">Hola</span>
                    </div>
                    <button class="btn-icon"><span class="material-icons-round">logout</span></button>
                </div>
            </header>
            <div id="userAnnouncement" class="btn-dashed-style announcement-box" style="display:none;">
                <h3 style="color:var(--accent);"> Noticias</h3>
                <p id="announcementText"></p>
            </div>
            <div class="tabs">
                <button class="tab-btn active">M煤sica</button>
                <button class="tab-btn">Playlist</button>
                <button class="tab-btn">lbum</button>
            </div>
            <div id="user-music" class="list-tab-content active">
                <div style="background:#252535; padding:10px; border-radius:12px; margin-bottom:15px; display:flex; align-items:center;">
                    <span class="material-icons-round" style="color:#aaa; margin-right:10px;">search</span>
                    <input type="text" id="searchInputUser" placeholder="Buscar canci贸n..." style="background:transparent; border:none; color:white; width:100%; outline:none;">
                </div>
                <div id="userSongList"></div>
            </div>
        </div>
    </div>

    <div id="mainPlayer" class="bottom-player" style="display:none;">
        <div class="player-info">
            <img id="pCoverMini" src="" style="width:45px; height:45px; border-radius:8px; object-fit:cover; background:#333;">
            <div style="overflow:hidden;">
                <h4 id="pTitle" style="margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">T铆tulo</h4>
                <p id="pArtist" style="margin:0;color:#aaa;font-size:0.8rem">Artista</p>
            </div>
        </div>
        <div class="player-center-group">
            <div class="controls-row">
                <span class="material-icons-round ctrl-icon small-icon">shuffle</span>
                <span class="material-icons-round ctrl-icon">skip_previous</span>
                <div class="btn-play-circle" id="btnPlayPause">
                    <span id="iconPlay" class="material-icons-round">play_arrow</span>
                </div>
                <span class="material-icons-round ctrl-icon">skip_next</span>
                <span class="material-icons-round ctrl-icon small-icon">repeat</span>
            </div>
            <input type="range" id="seekSlider" value="0" min="0" max="100">
        </div>
        <div class="player-right-group">
            <span class="material-icons-round small-icon" id="pLikeBtn">favorite_border</span>
            <span class="material-icons-round small-icon">graphic_eq</span>
            <span class="material-icons-round small-icon" id="btnExpandPlayer">open_in_full</span>
            <span class="material-icons-round small-icon" style="color:var(--danger)" id="btnClosePlayer">close</span>
        </div>
        <div class="minimized-player-controls">
            <span class="material-icons-round" id="btnExpandPlayerMobile" style="font-size:2rem; margin-right:10px;">expand_less</span>
            <span id="iconPlayMin" class="material-icons-round">play_arrow</span>
            <span class="material-icons-round" style="color:var(--danger)" id="btnClosePlayerMobile">close</span>
        </div>
    </div>

    <div id="view-guest-player">
        <div style="display:flex; justify-content:space-between; width:100%; padding:10px;">
            <span class="material-icons-round btn-guest-action" id="btnCloseFullscreen">keyboard_arrow_down</span>
            <span style="color:#aaa; font-size:0.9rem; letter-spacing:1px;">REPRODUCIENDO</span>
            <span class="material-icons-round btn-guest-action">graphic_eq</span>
        </div>
        <div class="guest-container">
            <div id="guestCover"></div>
            <div class="guest-info-area">
                <h2 id="guestTitle">T铆tulo</h2>
                <p id="guestArtist">Artista</p>
            </div>
            <div class="guest-controls-extra">
                <span class="material-icons-round btn-guest-action">share</span>
                <div id="guestLikeBtn">
                    <span class="material-icons-round btn-guest-action">favorite_border</span>
                </div>
                <span class="material-icons-round btn-guest-action">bedtime</span>
            </div>
            <div class="guest-controls-main"></div>
        </div>
    </div>

    <div id="customToast" class="customToast">Mensaje</div>

    <script>
        const API_BASE_URL = "https://api.jsonbin.io/v3/b/";
        const DEFAULT_COVER = "https://i.ibb.co/3WqP7tX/default-cover.png";
        const PERMANENT_BIN_ID = "69349a76ae596e708f880e31";
        const PERMANENT_API_KEY = "$2a$10$ME7fO8Oqq2iWhHkYQKGQsu0M6PqJ8d1ymFBxHVhhxFJ70BcAg1FZe";
        const ADMIN_AVATAR = "https://api.dicebear.com/7.x/avataaars/svg?seed=Chris";

        let appConfig = {
            BIN_ID: PERMANENT_BIN_ID,
            API_KEY: PERMANENT_API_KEY,
            data: null,
            user: null,
            isLoggedIn: false,
            isAdmin: false,
            currentSong: null,
            tempPlaylist: [],
            audioElement: null
        };

        function showToast(msg, type = 'info') {
            const toast = document.getElementById('customToast');
            toast.textContent = msg;
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 2500);
        }

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(v => {
                v.style.display = 'none';
                v.classList.remove('active');
            });
            const view = document.getElementById(viewId);
            if (view) {
                view.style.display = 'block';
                setTimeout(() => view.classList.add('active'), 10);
            }
            document.getElementById('view-login').style.display = 'none';
        }

        async function handleLoginAttempt() {
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const pass = document.getElementById('loginPass').value.trim();

            if (email === 'hjalmar' && pass === '258632') { 
                doLogin({ name: 'Hjalmar', email: 'admin@musichris.com', role: 'admin', avatar: ADMIN_AVATAR }); 
                return; 
            }
            
            if (!appConfig.data) {
                showToast("Conectando...", 'info');
                await loadAppData();
            }
            
            const user = appConfig.data?.users?.find(u => u.email.toLowerCase() === email);
            if (user && pass === (user.password || '123')) {
                doLogin(user);
            } else {
                showToast("Credenciales incorrectas", 'error');
            }
        }

        function doLogin(user) {
            appConfig.user = user;
            appConfig.isLoggedIn = true;
            appConfig.isAdmin = (user.role === 'admin');
            localStorage.setItem('appConfig', JSON.stringify({
                user, 
                isLoggedIn: true, 
                isAdmin: appConfig.isAdmin
            }));
            showView(appConfig.isAdmin ? 'view-admin' : 'view-user');
            loadAppData();
        }

        async function loadAppData() {
            try {
                const res = await fetch(`${API_BASE_URL}${PERMANENT_BIN_ID}`, {
                    headers: {'X-Master-Key': PERMANENT_API_KEY}
                });
                if (!res.ok) throw new Error("API Error");
                const json = await res.json();
                appConfig.data = json.record;
                
                if (!appConfig.data.songs) appConfig.data.songs = [];
                if (!appConfig.data.users) appConfig.data.users = [];
                if (!appConfig.data.albums) appConfig.data.albums = [];
                
                updateUI();
                showToast("Datos cargados", 'success');
            } catch(e) {
                console.error(e);
                showToast("Error de conexi贸n", 'error');
                
                appConfig.data = {
                    songs: [
                        { id: 1, title: "Canci贸n Demo", genre: "Demo Artist", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", plays: 10, likes: [] }
                    ],
                    users: [],
                    albums: []
                };
                updateUI();
            }
        }

        function updateUI() {
            if (document.getElementById('statsTotalSongs') && appConfig.data) {
                document.getElementById('statsTotalSongs').textContent = appConfig.data.songs.length;
            }
            if (document.getElementById('statsTotalUsers') && appConfig.data) {
                document.getElementById('statsTotalUsers').textContent = appConfig.data.users.length;
            }
            
            renderSongList(appConfig.isAdmin ? 'adminSongList' : 'userSongList', appConfig.data.songs);
            
            if (appConfig.user) {
                if (document.getElementById('adminAvatar')) 
                    document.getElementById('adminAvatar').src = appConfig.user.avatar || ADMIN_AVATAR;
                if (document.getElementById('userAvatarImg')) 
                    document.getElementById('userAvatarImg').src = appConfig.user.avatar || ADMIN_AVATAR;
                if (document.getElementById('adminNameDisplay')) 
                    document.getElementById('adminNameDisplay').textContent = appConfig.user.name;
                if (document.getElementById('userGreeting')) 
                    document.getElementById('userGreeting').textContent = `Hola ${appConfig.user.name}`;
            }
        }

        function renderSongList(containerId, songs) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            container.innerHTML = '';
            
            songs.forEach(song => {
                const div = document.createElement('div');
                div.className = 'song-list-item';
                
                const art = song.cover || DEFAULT_COVER;
                
                div.innerHTML = `
                    <div class="song-cover" style="background-image:url('${art}')"></div>
                    <div class="song-info">
                        <div class="song-title">${song.title}</div>
                        <div class="song-artist">${song.genre}</div>
                    </div>
                    <div class="song-actions">
                        <button class="btn-list-action" data-song-id="${song.id}">
                            <span class="material-icons-round">play_arrow</span>
                        </button>
                    </div>
                `;
                
                div.querySelector('.btn-list-action').addEventListener('click', (e) => {
                    e.stopPropagation();
                    playSong(song);
                });
                
                container.appendChild(div);
            });
        }

        function playSong(song) {
            console.log('Playing song:', song);
            
            appConfig.currentSong = song;
            
            const mainPlayer = document.getElementById('mainPlayer');
            if (mainPlayer) {
                mainPlayer.style.display = 'flex';
                mainPlayer.classList.remove('hidden');
            }
            
            const art = song.cover || DEFAULT_COVER;
            
            if (document.getElementById('pTitle')) 
                document.getElementById('pTitle').textContent = song.title;
            if (document.getElementById('pArtist')) 
                document.getElementById('pArtist').textContent = song.genre;
            if (document.getElementById('pCoverMini')) 
                document.getElementById('pCoverMini').src = art;
            
            if (appConfig.audioElement && song.url) {
                appConfig.audioElement.pause();
                appConfig.audioElement.src = song.url;
                appConfig.audioElement.load();
                
                appConfig.audioElement.play()
                    .then(() => {
                        console.log('Playing...');
                        updatePlayIcon(true);
                    })
                    .catch(err => {
                        console.error('Play error:', err);
                        showToast("Error al reproducir", 'error');
                        updatePlayIcon(false);
                    });
            }
        }

        function updatePlayIcon(isPlaying) {
            const icon = isPlaying ? 'pause' : 'play_arrow';
            
            const iconPlay = document.getElementById('iconPlay');
            if (iconPlay) iconPlay.textContent = icon;
            
            const iconPlayMin = document.getElementById('iconPlayMin');
            if (iconPlayMin) iconPlayMin.textContent = icon;
            
            const iconPlayBig = document.getElementById('iconPlayBig');
            if (iconPlayBig) iconPlayBig.textContent = icon;
        }

        function togglePlay() {
            if (!appConfig.audioElement) return;
            
            if (appConfig.audioElement.paused) {
                appConfig.audioElement.play()
                    .catch(err => console.error('Play error:', err));
            } else {
                appConfig.audioElement.pause();
            }
        }

        function openFullScreenPlayer() {
            if (!appConfig.currentSong) return;
            
            const fullscreen = document.getElementById('view-guest-player');
            if (fullscreen) {
                fullscreen.style.display = 'flex';
            }
            
            const mainPlayer = document.getElementById('mainPlayer');
            if (mainPlayer) {
                mainPlayer.classList.add('hidden');
            }
            
            if (document.getElementById('guestTitle')) 
                document.getElementById('guestTitle').textContent = appConfig.currentSong.title;
            if (document.getElementById('guestArtist')) 
                document.getElementById('guestArtist').textContent = appConfig.currentSong.genre;
            if (document.getElementById('guestCover')) {
                const art = appConfig.currentSong.cover || DEFAULT_COVER;
                document.getElementById('guestCover').style.backgroundImage = `url('${art}')`;
            }
            
            const controlsMain = document.querySelector('.guest-controls-main');
            if (controlsMain) {
                controlsMain.innerHTML = `
                    <span class="material-icons-round btn-guest-action">shuffle</span>
                    <span class="material-icons-round btn-guest-action" style="font-size:3rem">skip_previous</span>
                    <span class="material-icons-round btn-guest-action" id="iconPlayBig" style="font-size:4.5rem">pause</span>
                    <span class="material-icons-round btn-guest-action" style="font-size:3rem">skip_next</span>
                    <span class="material-icons-round btn-guest-action">repeat</span>
                `;
                
                const playBig = document.getElementById('iconPlayBig');
                if (playBig) {
                    playBig.addEventListener('click', togglePlay);
                }
            }
        }

        function closeFullScreenPlayer() {
            const fullscreen = document.getElementById('view-guest-player');
            if (fullscreen) {
                fullscreen.style.display = 'none';
            }
            
            const mainPlayer = document.getElementById('mainPlayer');
            if (mainPlayer) {
                mainPlayer.classList.remove('hidden');
            }
        }

        function closePlayer() {
            const mainPlayer = document.getElementById('mainPlayer');
            if (mainPlayer) {
                mainPlayer.style.display = 'none';
            }
            
            if (appConfig.audioElement) {
                appConfig.audioElement.pause();
            }
            
            appConfig.currentSong = null;
            
            closeFullScreenPlayer();
        }

        function updateProgress() {
            const audio = appConfig.audioElement;
            if (!audio || isNaN(audio.duration)) return;
            
            const percent = (audio.currentTime / audio.duration) * 100;
            
            const seekSlider = document.getElementById('seekSlider');
            if (seekSlider) seekSlider.value = percent;
        }

        function seekAudio(e) {
            if (!appConfig.audioElement) return;
            appConfig.audioElement.currentTime = appConfig.audioElement.duration * (e.target.value / 100);
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log('App iniciando...');
            
            appConfig.audioElement = document.createElement('audio');
            appConfig.audioElement.id = 'audioElement';
            document.body.appendChild(appConfig.audioElement);
            
            appConfig.audioElement.addEventListener('play', () => updatePlayIcon(true));
            appConfig.audioElement.addEventListener('pause', () => updatePlayIcon(false));
            appConfig.audioElement.addEventListener('timeupdate', updateProgress);
            appConfig.audioElement.addEventListener('ended', () => updatePlayIcon(false));
            appConfig.audioElement.addEventListener('error', (e) => {
                console.error("Audio error:", e);
                showToast("Error de audio", 'error');
                updatePlayIcon(false);
            });
            
            const btnLoginBtn = document.getElementById('btnLoginBtn');
            if (btnLoginBtn) {
                btnLoginBtn.addEventListener('click', handleLoginAttempt);
            }
            
            const btnTogglePass = document.getElementById('btnTogglePass');
            if (btnTogglePass) {
                btnTogglePass.addEventListener('click', function() {
                    const passInput = document.getElementById('loginPass');
                    if (passInput.type === 'password') {
                        passInput.type = 'text';
                        this.textContent = 'visibility';
                    } else {
                        passInput.type = 'password';
                        this.textContent = 'visibility_off';
                    }
                });
            }
            
            const btnPlayPause = document.getElementById('btnPlayPause');
            if (btnPlayPause) {
                btnPlayPause.addEventListener('click', (e) => {
                    e.stopPropagation();
                    togglePlay();
                });
            }
            
            const iconPlayMin = document.getElementById('iconPlayMin');
            if (iconPlayMin) {
                iconPlayMin.addEventListener('click', (e) => {
                    e.stopPropagation();
                    togglePlay();
                });
            }
            
            const btnExpandPlayer = document.getElementById('btnExpandPlayer');
            if (btnExpandPlayer) {
                btnExpandPlayer.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openFullScreenPlayer();
                });
            }
            
            const btnExpandPlayerMobile = document.getElementById('btnExpandPlayerMobile');
            if (btnExpandPlayerMobile) {
                btnExpandPlayerMobile.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openFullScreenPlayer();
                });
            }
            
            const btnClosePlayer = document.getElementById('btnClosePlayer');
            if (btnClosePlayer) {
                btnClosePlayer.addEventListener('click', (e) => {
                    e.stopPropagation();
                    closePlayer();
                });
            }
            
            const btnClosePlayerMobile = document.getElementById('btnClosePlayerMobile');
            if (btnClosePlayerMobile) {
                btnClosePlayerMobile.addEventListener('click', (e) => {
                    e.stopPropagation();
                    closePlayer();
                });
            }
            
            const btnCloseFullscreen = document.getElementById('btnCloseFullscreen');
            if (btnCloseFullscreen) {
                btnCloseFullscreen.addEventListener('click', closeFullScreenPlayer);
            }
            
            const seekSlider = document.getElementById('seekSlider');
            if (seekSlider) {
                seekSlider.addEventListener('input', seekAudio);
            }
            
            const saved = localStorage.getItem('appConfig');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    appConfig.user = parsed.user;
                    appConfig.isLoggedIn = parsed.isLoggedIn;
                    appConfig.isAdmin = parsed.isAdmin;
                } catch(e) {
                    console.error('Error parsing saved config:', e);
                }
            }
            
            if (appConfig.isLoggedIn && appConfig.user) {
                showView(appConfig.isAdmin ? 'view-admin' : 'view-user');
                loadAppData();
            } else {
                document.getElementById('view-login').style.display = 'flex';
            }
        });
    </script>
</body>
</html>





